<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Debug Sign Up Test</title>
</head>
<body>
  <h1>Debug Sign Up Test</h1>
  
  <form id="testForm">
    <div>
      <label>Email:</label><br>
      <input type="email" id="email" placeholder="test@example.com" required>
    </div>
    <br>
    <div>
      <label>Password:</label><br>
      <input type="password" id="password" placeholder="password123" required>
    </div>
    <br>
    <button type="submit">Test Sign Up</button>
  </form>

  <hr>
  
  <h3>Debug Actions:</h3>
  <button onclick="checkLocalStorage()">Check Current Users</button>
  <button onclick="clearUsers()">Clear All Users</button>
  <button onclick="testLocalStorage()">Test localStorage Access</button>
  
  <hr>
  
  <h3>Debug Output:</h3>
  <div id="output"></div>

  <script>
    function log(message) {
      const output = document.getElementById('output');
      output.innerHTML += '<p>' + new Date().toLocaleTimeString() + ': ' + message + '</p>';
      console.log(message);
    }

    function testLocalStorage() {
      try {
        // Test if localStorage is available and working
        localStorage.setItem('test', 'working');
        const testValue = localStorage.getItem('test');
        localStorage.removeItem('test');
        
        if (testValue === 'working') {
          log('‚úÖ localStorage is working correctly');
        } else {
          log('‚ùå localStorage test failed');
        }
      } catch (error) {
        log('‚ùå localStorage error: ' + error.message);
      }
    }

    function checkLocalStorage() {
      try {
        const users = localStorage.getItem('users');
        log('Raw localStorage data: ' + users);
        
        if (users) {
          const parsedUsers = JSON.parse(users);
          log('Number of users: ' + parsedUsers.length);
          log('Users: ' + JSON.stringify(parsedUsers, null, 2));
        } else {
          log('No users found in localStorage');
        }
      } catch (error) {
        log('‚ùå Error reading users: ' + error.message);
      }
    }

    function clearUsers() {
      localStorage.removeItem('users');
      log('üóëÔ∏è All users cleared from localStorage');
    }

    document.getElementById('testForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      
      log('üîÑ Starting signup process...');
      log('Email: ' + email);
      log('Password length: ' + password.length);

      try {
        // Get existing users
        let users = [];
        const existingUsers = localStorage.getItem('users');
        
        if (existingUsers) {
          users = JSON.parse(existingUsers);
          log('Found existing users: ' + users.length);
        } else {
          log('No existing users, creating new array');
        }

        // Check if user already exists
        const duplicate = users.find(u => u.email.toLowerCase() === email.toLowerCase());
        if (duplicate) {
          log('‚ùå User already exists!');
          return;
        }

        // Create new user
        const newUser = {
          id: Date.now(),
          email: email,
          password: password,
          role: 'user',
          createdAt: new Date().toISOString()
        };

        log('Created user object: ' + JSON.stringify(newUser, null, 2));

        // Add to array
        users.push(newUser);
        log('Added to users array. New length: ' + users.length);

        // Save to localStorage
        localStorage.setItem('users', JSON.stringify(users));
        log('üíæ Saved to localStorage');

        // Verify it was saved
        const verification = localStorage.getItem('users');
        if (verification) {
          const verifyParsed = JSON.parse(verification);
          log('‚úÖ Verification successful! Total users now: ' + verifyParsed.length);
          log('Latest user: ' + JSON.stringify(verifyParsed[verifyParsed.length - 1], null, 2));
        } else {
          log('‚ùå Verification failed - nothing in localStorage');
        }

        // Clear form
        document.getElementById('testForm').reset();
        
      } catch (error) {
        log('‚ùå Error during signup: ' + error.message);
        log('Error details: ' + error.stack);
      }
    });

    // Run initial tests when page loads
    window.addEventListener('load', function() {
      log('üöÄ Page loaded - running initial tests...');
      testLocalStorage();
      checkLocalStorage();
    });
  </script>
</body>
</html>